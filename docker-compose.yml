services:
  webhook-gateway:
    image: ghcr.io/carlnoah6/webhook-gateway:latest
    container_name: webhook-gateway
    restart: unless-stopped
    ports:
      - "8280:8280"
    volumes:
      # Mount the entire workspace to support absolute paths in legacy scripts
      - /home/ubuntu/.openclaw/workspace:/home/ubuntu/.openclaw/workspace
      # Mount the event directory explicitly (redundant but safe)
      - /home/ubuntu/.openclaw/workspace/data/ci-events:/app/ci-events
      # Mount secret file
      - ./webhook_secret.txt:/app/webhook_secret.txt:ro
    environment:
      - PORT=8280
      - OPENCLAW_WEBHOOK_URL=http://host.docker.internal:18789/webhook/lark
      - WEBHOOK_SECRET_FILE=/app/webhook_secret.txt
      - CI_EVENT_DIR=/app/ci-events
      - LARK_APP_ID=${LARK_APP_ID}
      - LARK_APP_SECRET=${LARK_APP_SECRET}
      # Point to the script location in the mounted workspace
      - DASHBOARD_REFRESH_SCRIPT=/home/ubuntu/.openclaw/workspace/scripts/lark-task-dashboard.py
    extra_hosts:
      - "host.docker.internal:host-gateway"
